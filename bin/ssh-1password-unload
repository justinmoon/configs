#!/usr/bin/env bash
# Remove 1Password SSH key from agent and clean up
# Run this after emergency access is no longer needed
set -euo pipefail

PUB_KEY_PATH="$HOME/.ssh/id_ed25519_1password.pub"

# Remove from agent using the public key
if [ -f "$PUB_KEY_PATH" ]; then
    if ssh-add -d "$PUB_KEY_PATH" 2>/dev/null; then
        echo "1Password SSH key removed from agent."
    else
        echo "1Password SSH key was not in the agent."
    fi
    # Clean up the public key file
    rm -f "$PUB_KEY_PATH"
    echo "Public key file cleaned up."
else
    echo "No 1Password public key found (was it ever loaded?)."
fi
