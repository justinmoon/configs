---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }));
}

const post = Astro.props;
const { Content } = await post.render();
---

<BaseLayout title={post.data.title} description={post.data.description}>
  <a href="/" class="back-link">‚Üê Back to posts</a>
  
  <h1>{post.data.title}</h1>
  <div class="post-meta">
    {post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
  </div>
  
  <Content />

  <hr />
  
  <h2>Comments</h2>
  <div id="nocomment-container">
    <script 
      src="https://nocomment.fiatjaf.com/embed.js" 
      id="nocomment"
      data-relays='["wss://relay.damus.io", "wss://relay.primal.net", "wss://nos.lol", "wss://relay.nostr.band", "wss://nostr.wine"]'
      data-placeholder="Leave a comment (via Nostr)..."
    ></script>
  </div>

  <style>
    #nocomment-container {
      margin: 2em 0;
    }

    /* Style nocomment to match blog theme */
    :root {
      --nc-background: #fff;
      --nc-container-font-family: monospace;
      --nc-container-font-size: 16px;
      --nc-comment-author-font-size: 1em;
      --nc-comment-author-font-family: monospace;
      --nc-comment-author-font-color: #000;
      --nc-comment-date-color: #666;
      --nc-comment-date-font-family: monospace;
      --nc-comment-date-font-size: 0.9em;
      --nc-link-text-decor: none;
      --nc-link-text-decor-hover: underline;
      --nc-textarea-font-family: monospace;
      --nc-textarea-font-size: 16px;
      --nc-text-background: #f5f5f5;
      --nc-text-color: #000;
      --nc-text-color-dark: #000;
      --nc-primary-color: #00f;
      --nc-primary-contrast: #fff;
    }
  </style>
</BaseLayout>
